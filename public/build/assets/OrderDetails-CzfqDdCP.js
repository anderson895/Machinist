import{q as j,S as k,r as D,j as e,a as S,V as m}from"./app-Xobat-FU.js";import{P as U}from"./PrimaryButton-tjVAZleo.js";import{S as R}from"./SelectInput-BYFEZPwX.js";import{I as p}from"./InputError-BhERdZOb.js";import{I as x}from"./InputLabel-C4fgOz4K.js";import{T as A}from"./TextInput-yCmsFnD1.js";import{T}from"./TextAreaInput-D2xFeg7a.js";import"./FileInput-CEc4c1B9.js";import I from"./ProofOfPaymentUpload-dZtd3dJ1.js";import C from"./ProofOfDeliveryUpload-Drumcvsi.js";import{A as F}from"./AuthenticatedLayout-Cj0nyHL4.js";import"./Modal-DsUhjpN5.js";import"./transition-ZmkV3jRI.js";import"./SecondaryButton-BYvZmWXL.js";import"./ApplicationLogo-BXXghqJZ.js";function Y(){const c=j().props.auth.user,s=j().props.order,o=s.offer;var f=s.offer.thread.inquiry.user;console.log(s);const n=c.id===o.thread.user_id,{data:a,setData:d,post:v,processing:g,errors:u,reset:y}=k({id:s.id,status:s.status??"",total_amount:s.total_amount??"",notes:s.notes??""});D.useEffect(()=>{d({id:s.id,status:s.status??"",total_amount:s.total_amount??"",notes:s.notes??""})},[s]);const N=t=>{if(t.preventDefault(),a.total_amount<1||notes==""){m.error("Please input the total amount and add notes for customer.");return}if(a.status=="Ready To Pick Up"||a.status=="Order Ship",(a.status==="Picked Up"||a.status==="Delivered")&&!s.proof_of_delivery){const r=a.status==="Picked Up"?"Please upload proof of pick up":"Please upload proof of delivery";m.error(r);return}v("/save-order",{preserveScroll:!0,forceFormData:!0,onSuccess:()=>{m.success("Order saved!"),y()},onError:()=>{m.error("Something went wrong. Please try again.")}})},P=t=>t.reduce((r,l)=>(r[l.label]||(r[l.label]=[]),r[l.label].push(l),r),{}),b=o.mod,h=o.mop,_={"Pick Up":{"Online Payment":["Pending","Waiting for Payment","Accepted","Preparing","Ready To Pick Up","Picked Up","Rejected"],COP:["Pending","Accepted","Preparing","Ready To Pick Up","Picked Up","Rejected"]},Deliver:{"Online Payment":["Pending","Waiting for Payment","Accepted","Preparing","Order Ship","Delivered","Rejected"],COD:["Pending","Accepted","Preparing","Order Ship","Delivered","Rejected"]}},w=()=>{console.log(a.status);const t=_[b][h],r=t.indexOf(a.status),l=t.indexOf("Accepted");return a.status==="Rejected"?[{value:"Rejected",label:"Rejected"}]:t.filter((i,O)=>i===a.status?!0:i==="Waiting for Payment"?a.status==="Pending"&&h==="Online Payment":i==="Rejected"?r<l:O===r+1).map(i=>({value:i,label:i}))};return e.jsxs(F,{header:e.jsx("h2",{className:"text-xl font-semibold leading-tight text-gray-800",children:"Order Details"}),children:[e.jsx(S,{title:"Orders"}),s.status=="Waiting for Payment"&&s.proof_of_payment==null&&c.id==f.id&&e.jsx("div",{className:"pt-5 pb-3 mx-auto max-w-7xl sm:px-6 lg:px-8 px-4",children:e.jsx(I,{order_id:s.id})}),(s.status=="Order Ship"||s.status=="Ready To Pick Up")&&s.proof_of_delivery==null&&c.id==o.thread.user_id&&e.jsx("div",{className:"pt-5 pb-3 mx-auto max-w-7xl sm:px-6 lg:px-8 px-4",children:e.jsx(C,{order_id:s.id})}),e.jsx("form",{onSubmit:N,encType:"multipart/form-data",className:"",children:e.jsx("div",{className:"pt-4 pb-3 mx-auto max-w-7xl sm:px-6 lg:px-8 px-4",children:e.jsxs("div",{className:"overflow-hidden bg-white shadow-sm sm:rounded-sm p-3",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center justify-between flex-wrap",children:[e.jsx("h1",{className:"text-md font-bold",children:f.name}),e.jsx("h3",{className:"text-sm",children:new Date(s.created_at).toLocaleString()})]}),e.jsxs("div",{className:"bg-gray-100 mt-5 p-3",children:[e.jsx("h1",{className:"font-bold text-sm",children:"Offer Details"}),e.jsxs("div",{className:"text-xs flex flex-col md:flex-row gap-3",children:[e.jsxs("div",{className:"w-full md:w-[50%]",children:[e.jsx("div",{className:"py-3",children:e.jsx("div",{children:o.description})}),e.jsxs("div",{children:["Price: ",o.price]}),e.jsxs("div",{children:["Delivery Date:"," ",new Date(o.delivery_time).toLocaleString()]}),e.jsxs("div",{children:["Mode of Delivery: ",o.mod]}),e.jsxs("div",{children:["Mode of Payment: ",o.mop]})]}),e.jsxs("div",{className:"w-full md:w-[50%]",children:[e.jsx("div",{className:"text-xs",children:"Attached Files:"}),Object.entries(P(o.files)).map(([t,r])=>e.jsxs("div",{className:"mb-3",children:[e.jsxs("div",{className:"text-xs font-bold m-0",children:[t.toUpperCase(),":"]}),e.jsx("ul",{children:r.map(l=>e.jsx("div",{children:e.jsx("a",{href:`/uploads/${l.file_name}`,target:"_blank",rel:"noopener noreferrer",className:"m-0 mb-1 text-xs inline-block text-blue-600 hover:underline",children:l.file_name})},`file-${l.id}`))})]},t))]})]})]})]}),e.jsxs("div",{className:"flex justify-between flex-wrap",children:[e.jsxs("div",{className:"mt-5",children:[e.jsx(x,{htmlFor:"price",value:"Total Amount"}),e.jsx(A,{id:"total_amount",name:"total_amount",className:"mt-1 block w-full",value:a.total_amount,onChange:t=>d("total_amount",t.target.value),isFocused:!0,autoComplete:"total_amount",type:"number",disabled:a.status!="Pending"||!n}),e.jsx(p,{className:"mt-2",message:u.total_amount})]}),e.jsxs("div",{className:"mt-5",children:[e.jsx(x,{htmlFor:"status",value:"Status"}),e.jsx(R,{id:"status",name:"status",className:" mt-1 block w-full",value:a.status,onChange:t=>d("status",t.target.value),options:w(),disabled:!n}),e.jsx(p,{className:"mt-2",message:u.status})]})]}),e.jsx("div",{children:e.jsxs("div",{className:"mt-5",children:[e.jsx(x,{htmlFor:"notes",value:"Notes"}),e.jsx(T,{id:"notes",name:"notes",className:"mt-1 block w-full",value:a.notes,onChange:t=>d("notes",t.target.value),isFocused:!0,autoComplete:"notes",disabled:!n}),e.jsx(p,{className:"mt-2",message:u.notes})]})}),s.proof_of_payment!=null&&e.jsxs("div",{className:"mt-10",children:[e.jsx("hr",{}),e.jsxs("div",{className:"mt-5",children:[e.jsx("h1",{className:"font-bold",children:"Proof of Payment:"}),e.jsx("div",{className:"flex justify-center",children:e.jsx("img",{className:"max-w-[300px]",src:`/uploads/${s.proof_of_payment}`,alt:""})})]})]}),s.proof_of_delivery!=null&&e.jsxs("div",{className:"mt-10",children:[e.jsx("hr",{}),e.jsxs("div",{className:"mt-5",children:[e.jsx("h1",{className:"font-bold",children:"Proof of Delivery/Picked Up:"}),e.jsx("div",{className:"flex justify-center",children:e.jsx("img",{className:"max-w-[300px]",src:`/uploads/${s.proof_of_delivery}`,alt:""})})]})]}),n&&e.jsx("div",{className:"mt-6 flex justify-end",children:e.jsx(U,{className:"ms-3",disabled:g,children:"Save"})})]})})})]})}export{Y as default};
